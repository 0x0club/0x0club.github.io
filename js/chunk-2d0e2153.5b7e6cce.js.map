{"version":3,"sources":["webpack:///./src/views/Card.vue?0067","webpack:///src/views/Card.vue","webpack:///./src/views/Card.vue?2cce","webpack:///./src/views/Card.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","bnx","attrs","on","getCard","batchGetCard","staticRenderFns","name","mixins","data","methods","component"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,cAAc,CAACA,EAAG,KAAK,CAACE,YAAY,uBAAuB,CAACN,EAAIO,GAAG,QAAQH,EAAG,KAAK,CAACE,YAAY,eAAe,CAACN,EAAIO,GAAG,eAAeH,EAAG,IAAI,CAACJ,EAAIO,GAAGP,EAAIQ,GAAGR,EAAIS,KAAK,aAAaL,EAAG,MAAMA,EAAG,SAAS,CAACE,YAAY,eAAe,CAACF,EAAG,UAAU,CAACA,EAAG,WAAW,CAACM,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQX,EAAIY,UAAU,CAACZ,EAAIO,GAAG,QAAQH,EAAG,WAAW,CAACM,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQX,EAAIa,eAAe,CAACb,EAAIO,GAAG,UAAU,IAAI,IAAI,IACpgBO,EAAkB,G,wDCsBtB,GACEC,KAAM,OACNC,OAAQ,CAACA,EAAX,MACEC,KAHF,WAII,MAAO,CACLR,IAAK,IAGT,QARF,WAQA,wKACA,oBADA,UAEA,UAFA,iEAMA,iBANA,uBAOA,cAPA,wBAQA,mBARA,+CAUES,QAAS,CAEP,UAFJ,WAEA,8KACA,kDADA,OACA,EADA,OAEA,qBACA,WACA,iDAJA,8CAOI,QATJ,WASA,4LACA,cADA,uBAEA,yCAFA,cAEA,EAFA,gBAGA,4CAHA,cAGA,EAHA,iBAIA,yCAJA,WAIA,EAJA,OAKA,yBACA,iCAEA,QARA,wBAUA,6BAVA,kCAaA,qCAEA,uBACA,iBACA,eAjBA,UAmBA,yDACA,CACA,eACA,UAtBA,QAmBA,EAnBA,OAyBA,sBAEA,uBACA,sBACA,MACA,eACA,QACA,YAhCA,+CAmCI,aA5CJ,WA4CA,8JACA,IADA,YACA,KADA,gCAEA,YAFA,OACA,IADA,6DAKI,eAjDJ,WAiDA,wLACA,mDADA,cACA,EADA,gBAEA,sDAFA,cAEA,EAFA,gBAGA,qDAHA,cAGA,EAHA,iBAIA,qDAJA,eAIA,EAJA,iBAKA,sDALA,QAQA,IAHA,EALA,OAMA,uBAEA,aARA,iDC1F+d,I,YCO3dC,EAAY,eACd,EACApB,EACAe,GACA,EACA,KACA,KACA,MAIa,aAAAK,E","file":"js/chunk-2d0e2153.5b7e6cce.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('base-layout',[_c('h2',{staticClass:\"text-center my-30px\"},[_vm._v(\"抽卡\")]),_c('h3',{staticClass:\"text-center\"},[_vm._v(\" 当前bnx 数量： \"),_c('b',[_vm._v(_vm._s(_vm.bnx)+\" bnx \")])]),_c('br'),_c('a-card',{staticClass:\"text-center\"},[_c('a-space',[_c('a-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.getCard}},[_vm._v(\"单抽\")]),_c('a-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.batchGetCard}},[_vm._v(\"五连抽\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <base-layout>\n    <h2 class=\"text-center my-30px\">抽卡</h2>\n    <h3 class=\"text-center\">\n      当前bnx 数量：\n      <b>{{ bnx }} bnx </b>\n    </h3>\n    <br />\n\n    <a-card class=\"text-center\">\n      <a-space>\n        <a-button type=\"primary\" @click=\"getCard\">单抽</a-button>\n        <a-button type=\"primary\" @click=\"batchGetCard\">五连抽</a-button>\n      </a-space>\n    </a-card>\n  </base-layout>\n</template>\n\n<script>\n// @ is an alias to /src\n// import HelloWorld from '@/components/HelloWorld.vue'\nimport mixins from \"../mixins\";\n\nexport default {\n  name: \"Home\",\n  mixins: [mixins],\n  data() {\n    return {\n      bnx: 0,\n    };\n  },\n  async created() {\n    await this.initWeb3Account();\n    if (!this.account) {\n      return;\n    }\n\n    await this.initContract();\n    await this.updateBnx();\n    await this.getCurrentCard();\n  },\n  methods: {\n    // 获取当前钱包的 bnx 数量\n    async updateBnx() {\n      const bnx = await this.bnxContract.methods.balanceOf(this.account).call();\n      console.log(\"bnx\", bnx);\n      this.rawBnx = bnx;\n      this.bnx = this.web3.utils.fromWei(bnx.toString(), \"ether\");\n    },\n    // 单次抽卡\n    async getCard() {\n      await this.updateBnx();\n      const goldPay = await this.playContract.methods.payValue().call();\n      const bnxPay = await this.playContract.methods.payBnxValue().call();\n      const bnbPay = await this.playContract.methods.bnbValue().call();\n      const needBnx = new this.web3.utils.BN(bnxPay);\n      const currentBnx = new this.web3.utils.BN(this.rawBnx);\n\n      if (needBnx.gt(currentBnx)) {\n        // bnx 数量不足\n        this.$message.error(\"bnx 数量不足\");\n        return;\n      }\n      console.log(\"newPlayerTrade:\", goldPay, bnxPay, entropyString);\n\n      const t = new Date().getTime();\n      const entropyString = this.account + t + \"\";\n      console.log(t)\n\n      const gas = await this.playContract.methods.newPlayerTrade(goldPay, bnxPay, entropyString).estimateGas(\n          {\n            from: this.account,\n            value: bnbPay\n          }\n      );\n      console.log(\"gas:\", gas);\n\n      this.playContract.methods\n        .newPlayerTrade(goldPay, bnxPay, entropyString)\n        .send({\n          from: this.account,\n          value: bnbPay,\n          gas: gas + 1e5\n        });\n    },\n    async batchGetCard() {\n      for (let i = 0; i < 5; i++) {\n        await this.getCard();\n      }\n    },\n    async getCurrentCard() {\n      const mageCount = await this.mageContract.methods.balanceOf(this.account).call();\n      const warriorCount = await this.warriorContract.methods.balanceOf(this.account).call();\n      const rangerCount = await this.rangerContract.methods.balanceOf(this.account).call();\n      const robberCount = await this.robberContract.methods.balanceOf(this.account).call();\n      const katrinaCount = await this.katrinaContract.methods.balanceOf(this.account).call();\n      console.log( mageCount, rangerCount, robberCount, warriorCount, katrinaCount)\n      // const tokenIds = []\n      for (let i = 0; i < mageCount; i++) {\n       // const tokenId = this.mageContract.methods\n      }\n    }\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/windicss-webpack-plugin/dist/loaders/pitcher.js!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/windicss-webpack-plugin/dist/loaders/transform-template.js!./Card.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/windicss-webpack-plugin/dist/loaders/pitcher.js!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/windicss-webpack-plugin/dist/loaders/transform-template.js!./Card.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Card.vue?vue&type=template&id=3cdeba9c&\"\nimport script from \"./Card.vue?vue&type=script&lang=js&\"\nexport * from \"./Card.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}